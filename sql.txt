-- REI Product Boost – Clean Audit CSV for AP/Jithin (no CTE version)
-- DS: r_ds_iraction_sharded

SELECT
  advertiser_id,
  campaign_id,
  publisher_id               AS media_partner_id,
  action_id,
  oid,
  CONCAT(oid, '_c')          AS new_oid_for_resubmit,
  action_date                AS action_datetime_utc,
  sku,
  quantity,
  adv_saleamt                AS item_adv_sale_amount,
  adv_currency,
  payout_trace,

  -- mark boost-eligible lines
  CASE
    WHEN (oid = 'A385560474' AND sku = '2399930003') THEN 1
    WHEN (oid = 'A385595006' AND sku = '2130310001') THEN 1
    WHEN (oid = 'A385443249' AND sku = '2404130003') THEN 1
    WHEN (oid = 'A385633257' AND sku = '2389770002') THEN 1
    WHEN (oid = 'A385643176' AND sku = '2397930003') THEN 1
    WHEN (oid = 'A385648053' AND sku = '2396240003') THEN 1
    WHEN (oid = 'A385659112' AND sku = '1996680001') THEN 1
    WHEN (oid = 'A385710403' AND sku = '2399920003') THEN 1
    WHEN (oid = 'A385720943' AND sku = '2255980003') THEN 1
    ELSE 0
  END AS boost_category_flag,

  -- expected boosted commission only for boost-eligible rows
  CASE
    WHEN (oid = 'A385560474' AND sku = '2399930003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385595006' AND sku = '2130310001') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385443249' AND sku = '2404130003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385633257' AND sku = '2389770002') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385643176' AND sku = '2397930003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385648053' AND sku = '2396240003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385659112' AND sku = '1996680001') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385710403' AND sku = '2399920003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385720943' AND sku = '2255980003') THEN ROUND(adv_saleamt * 0.20, 2)
    ELSE NULL
  END AS expected_boost_commission,

  4018 AS product_boost_campaign_id

FROM irac_action2
WHERE advertiser_id = 3622523
  AND campaign_id   = 17195
  AND oid IN ('A385560474','A385595006','A385443249','A385633257','A385643176',
              'A385648053','A385659112','A385710403','A385720943')
  -- drop negative adjustment rows; we want the positive sale line
  AND NOT (quantity < 0 OR adv_saleamt < 0)
ORDER BY action_date, action_id, sku;
+---------------+-------------+------------------+--------------------+------------+----------------------+---------------------+------------+----------+----------------------+--------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+---------------------------+---------------------------+
| advertiser_id | campaign_id | media_partner_id | action_id          | oid        | new_oid_for_resubmit | action_datetime_utc | sku        | quantity | item_adv_sale_amount | adv_currency | payout_trace                                                                                                                                                | boost_category_flag | expected_boost_commission | product_boost_campaign_id |
+---------------+-------------+------------------+--------------------+------------+----------------------+---------------------+------------+----------+----------------------+--------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+---------------------------+---------------------------+
|       3622523 |       17195 |          2850304 | 17195.6495.862361  | A385560474 | A385560474_c         | 2025-10-14 00:56:44 | 2399930003 |        1 |               679.95 | USD          | {"ContractId":"S-28388457","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","DefaultPayoutRate":"15%"}                               |                   1 |                    135.99 |                      4018 |
|       3622523 |       17195 |          2850304 | 17195.6495.862361  | A385560474 | A385560474_c         | 2025-10-14 00:56:44 | 2409480004 |        1 |               749.95 | USD          | {"ContractId":"S-28388457","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","DefaultPayoutRate":"15%"}                               |                   0 |                         ʘ |                      4018 |
|       3622523 |       17195 |          2022587 | 17195.6496.685543  | A385595006 | A385595006_c         | 2025-10-14 20:11:13 | 2130310001 |        1 |               279.95 | USD          | {"ContractId":"S-29324378","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"10%"} |                   1 |                     55.99 |                      4018 |
|       3622523 |       17195 |          2022587 | 17195.6496.719473  | A385443249 | A385443249_c         | 2025-10-14 20:26:31 | 2404130003 |        1 |               489.93 | USD          | {"ContractId":"S-29324378","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"10%"} |                   1 |                     97.99 |                      4018 |
|       3622523 |       17195 |          6213049 | 17195.6497.742556  | A385633257 | A385633257_c         | 2025-10-15 21:40:53 | 2389770002 |        1 |               224.83 | USD          | {"ContractId":"S-28932938","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"5%"}  |                   1 |                     44.97 |                      4018 |
|       3622523 |       17195 |          2022587 | 17195.6497.1163174 | A385643176 | A385643176_c         | 2025-10-16 02:40:48 | 2397930003 |        1 |               299.95 | USD          | {"ContractId":"S-29324378","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"10%"} |                   1 |                     59.99 |                      4018 |
|       3622523 |       17195 |          2850304 | 17195.6497.1241878 | A385648053 | A385648053_c         | 2025-10-16 04:25:27 | 2396240003 |        1 |               979.95 | USD          | {"ContractId":"S-28388457","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"15%"} |                   1 |                    195.99 |                      4018 |
|       3622523 |       17195 |          2022587 | 17195.6498.200484  | A385659112 | A385659112_c         | 2025-10-16 14:35:50 | 1996680001 |        1 |               139.95 | USD          | {"ContractId":"S-29324378","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"10%"} |                   1 |                     27.99 |                      4018 |
|       3622523 |       17195 |          2850304 | 17195.6499.320825  | A385710403 | A385710403_c         | 2025-10-17 16:18:51 | 2399920003 |        1 |               629.95 | USD          | {"ContractId":"S-28388457","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"15%"} |                   1 |                    125.99 |                      4018 |
|       3622523 |       17195 |          2850304 | 17195.6499.412122  | A385720943 | A385720943_c         | 2025-10-17 17:55:22 | 2255980003 |        1 |               899.00 | USD          | {"ContractId":"S-28388457","EventTypeId":33010,"EventTypeName":"Online Sale","PayoutLevel":"ORDER","PayoutLevelOverride":"MIXED","DefaultPayoutRate":"15%"} |                   1 |                    179.80 |                      4018 |
+---------------+-------------+------------------+--------------------+------------+----------------------+---------------------+------------+----------+----------------------+--------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+---------------------------+---------------------------+