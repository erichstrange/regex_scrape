SELECT
  DATE_TRUNC('DAY', event_datetime) AS dt,
  campaign_id,
  COUNT(*) AS clicks
FROM click_fact
WHERE publisher_id = 6251546
  AND event_datetime >= '2025-10-19'
  AND event_datetime <  '2025-11-12'
GROUP BY dt, campaign_id
ORDER BY dt, campaign_id;


SELECT COALESCE(method, '<null>') AS method, COUNT(*) AS clicks
FROM click_fact
WHERE publisher_id = 6251546
  AND event_datetime >= '2025-10-19'
  AND event_datetime <  '2025-11-12'
GROUP BY method
ORDER BY clicks DESC;

SELECT
  click_id,
  COUNT(*) AS n,
  MIN(event_datetime) AS first_seen,
  MAX(event_datetime) AS last_seen,
  GROUP_CONCAT(classification ORDER BY event_datetime) AS classes
FROM click_fact
WHERE publisher_id = 6251546
  AND event_datetime >= '2025-10-19'
  AND event_datetime <  '2025-11-12'
GROUP BY click_id
HAVING COUNT(*) > 1
ORDER BY n DESC, first_seen;

SELECT landing_page_url_noquery AS landing_page, COUNT(*) AS clicks
FROM click_fact
WHERE publisher_id = 6251546
  AND event_datetime >= '2025-10-19'
  AND event_datetime <  '2025-11-12'
GROUP BY landing_page
ORDER BY clicks DESC;

SELECT
  SUM(CASE WHEN JSON_EXTRACT_STRING(json,'ruleName')     IS NOT NULL THEN 1 ELSE 0 END) AS with_rule_name,
  SUM(CASE WHEN JSON_EXTRACT_STRING(json,'blockingRule') IS NOT NULL THEN 1 ELSE 0 END) AS with_blocking_rule,
  SUM(IFNULL(JSON_EXTRACT_BIGINT(json,'orgdc'),0)) AS datacenter_flags
FROM click_fact
WHERE publisher_id = 6251546
  AND event_datetime >= '2025-10-19'
  AND event_datetime <  '2025-11-12';

