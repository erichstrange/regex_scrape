-- VETTED PATTERN: API Logs by DateRange
-- DS: r_ds_ods
SELECT *
FROM ir_api_log
WHERE iram_account_id = 4984840
  AND doe >= '2025-11-11'
  AND doe <  '2025-11-16'
ORDER BY submit_date DESC
LIMIT 1000;


-- DRAFT: error-focused view
-- DS: r_ds_ods
SELECT
  id,
  batch_id,
  ircm_campaign_id,
  ircm_tracker_id,
  submit_date,
  type,
  oid,
  event_code,
  error_json
FROM ir_api_log
WHERE iram_account_id = 4984840
  AND doe >= '2025-11-11'
  AND doe <  '2025-11-16'
  AND error_json IS NOT NULL
  AND error_json NOT LIKE '%OID_DUPLICATE%'
  AND error_json NOT LIKE '%CONV_DUPLICATE%'
ORDER BY submit_date DESC
LIMIT 500;


-- VETTED-BASED: Tech Integration snapshot for AXS UK
-- DS: ircm
SELECT
  ircm_campaign_id,
  tracking_domain,
  tracking_domain_type,
  imp_track_domain,
  base_site_domain,
  permitted_deeplink_domains,
  global_url_params,
  dlu,
  ulu
FROM ircm_technicalintegration
WHERE ircm_campaign_id = 22439;


-- VETTED: Tech Integration audit log for campaign 22439
-- DS: r_ds_ods
SELECT
  change_date,
  username,
  auditedvariable,
  previousval,
  newval
FROM m_audit_log_entry
WHERE objectclassname = 'estalea.ir.cm.campaign.domain.TechnicalIntegration'
  AND objectid = 22439
  AND newval != previousval
  AND NOT (previousval = 'NODATA' AND newval = '')
ORDER BY change_date DESC
LIMIT 400;



-- VETTED PATTERN: Daily conversion counts
-- DS: singlestore
SELECT
  campaign_id,
  date_trunc('DAY', event_datetime) AS conv_date,
  COUNT(*) AS conv_count
FROM conversion_fact
WHERE campaign_id = 22439
  AND event_datetime >= '2025-11-01'
  AND event_datetime <  '2025-11-18'
GROUP BY campaign_id, conv_date
ORDER BY conv_date;
