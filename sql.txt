SELECT
    ins.name AS template_term_name
  , st.name AS scheduled_term_name
  , st.start_date
  , st.end_Date
  , atr1.name AS tracker_name_1
  , JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[0].actionTracker')) AS payout_tracker_1
  , atr2.name AS tracker_name_2
  , JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[1].actionTracker')) AS payout_tracker_2
  , atr3.name AS tracker_name_3
  , JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[2].actionTracker')) AS payout_tracker_3
  , atr4.name AS tracker_name_4
  , JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[3].actionTracker')) AS payout_tracker_4
  , st.archived
  , st.doe
  , st.uoe
  , st.dlu
  , st.ulu
FROM ircm_scheduled_terms st
INNER JOIN ircm_insertionorder ins
  ON ins.id = st.ircm_insertionorder_id

LEFT JOIN ircm_actiontracker atr1
  ON atr1.ircm_campaign_id = st.ircm_campaign_id
 AND atr1.id = JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[0].actionTracker'))

LEFT JOIN ircm_actiontracker atr2
  ON atr2.ircm_campaign_id = st.ircm_campaign_id
 AND atr2.id = JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[1].actionTracker'))

LEFT JOIN ircm_actiontracker atr3
  ON atr3.ircm_campaign_id = st.ircm_campaign_id
 AND atr3.id = JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[2].actionTracker'))

LEFT JOIN ircm_actiontracker atr4
  ON atr4.ircm_campaign_id = st.ircm_campaign_id
 AND atr4.id = JSON_UNQUOTE(JSON_EXTRACT(CAST(st.payout_json AS JSON), '$.actionTrackers[3].actionTracker'))

WHERE st.ircm_campaign_id = 5048
-- AND st.start_date >= NOW()     -- uncomment for upcoming-only
ORDER BY st.start_date DESC;
+--------------------+---------------------+------------+----------+----------------+------------------+----------------+------------------+----------------+------------------+----------------+------------------+----------+-----+-----+-----+-----+
| template_term_name | scheduled_term_name | start_date | end_Date | tracker_name_1 | payout_tracker_1 | tracker_name_2 | payout_tracker_2 | tracker_name_3 | payout_tracker_3 | tracker_name_4 | payout_tracker_4 | archived | doe | uoe | dlu | ulu |
+--------------------+---------------------+------------+----------+----------------+------------------+----------------+------------------+----------------+------------------+----------------+------------------+----------+-----+-----+-----+-----+
+--------------------+---------------------+------------+----------+----------------+------------------+----------------+------------------+----------------+------------------+----------------+------------------+----------+-----+-----+-----+-----+






SELECT
  cap.account_user_id,
  ce.username,
  cr.id   AS role_id,
  cr.name AS role_name,
  cr.permissionType,
  cr.description
FROM core_authorization_principal cap
JOIN core_role cr
  ON cr.id = cap.core_role_id
JOIN core_estaleauser ce
  ON ce.id = cap.account_user_id
WHERE cap.userType_id = 0
  AND cap.irAccount_id = 344628
  AND cap.account_user_id IN (374965, 6763885)
ORDER BY cap.account_user_id, cr.name;


SELECT
  cap.account_user_id,
  ce.username,
  cr.name AS role_name,
  cp.name AS permission_name
FROM core_authorization_principal cap
JOIN core_role cr
  ON cr.id = cap.core_role_id
JOIN core_role_permission crp
  ON crp.core_role_id = cr.id
JOIN core_permission cp
  ON cp.id = crp.core_permission_id
JOIN core_estaleauser ce
  ON ce.id = cap.account_user_id
WHERE cap.userType_id = 0
  AND cap.irAccount_id = 344628
  AND cap.account_user_id IN (374965, 6763885)
  AND cp.name IN (
    'PERMISSION_NEGOTIATE_AGREEMENTS',
    'PERMISSION_NEGOTIATE_AGREEMENTS_CREATOR'
  )
ORDER BY cap.account_user_id, role_name, permission_name;




SELECT
  id,
  program_id,
  publisher_account_id,
  ircm_insertionorder_id,
  ircm_ioterms_id,
  date_contract_start,
  date_contract_end,
  initiation_source,
  username_brand_signer,
  username_publisher_signer,
  version,
  doe,
  dlu
FROM platform_io_contract_upcoming
WHERE program_id = 5048
  AND publisher_account_id = 2533699
ORDER BY date_contract_start DESC;

