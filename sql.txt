-- Recent Online Leads â€“ check adv_cust_id (CustomerId)
-- DS: r_ds_iraction_sharded
SELECT
  action_date,
  doe,
  oid,
  adv_cust_id,           -- this is the CustomerId
  action_tracker_id
FROM irac_action2
WHERE campaign_id = 16636         -- Paychex
  AND action_tracker_id = 31842   -- Online Lead
  AND action_date >= '2025-12-08' -- since they deployed fix
ORDER BY doe DESC
LIMIT 200;


-- Recent children and whether they have a matching parent by adv_cust_id
-- DS: r_ds_iraction_sharded
SELECT
  child.action_date        AS child_date,
  child.doe                AS child_doe,
  child.oid                AS child_oid,
  child.action_tracker_id  AS child_tracker,
  child.adv_cust_id        AS child_adv_cust_id,
  parent.action_date       AS parent_date,
  parent.doe               AS parent_doe,
  parent.oid               AS parent_oid,
  parent.adv_cust_id       AS parent_adv_cust_id
FROM irac_action2 child
LEFT JOIN irac_action2 parent
  ON parent.campaign_id    = child.campaign_id
 AND parent.action_tracker_id = 31842         -- Online Lead
 AND parent.adv_cust_id    = child.adv_cust_id -- this is the CustomerId join
WHERE child.campaign_id    = 16636
  AND child.action_tracker_id IN (31843, 31844) -- Qualified / Recycles
  AND child.action_date    >= '2025-12-08'
ORDER BY child.doe DESC
LIMIT 200;
