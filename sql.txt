-- DRAFT â€“ Conversions by day & event type around the spike
-- Datasource: singlestore (TS), conversions

SELECT
  DATE(cf.event_datetime)              AS event_day,
  cf.action_tracker_id                 AS event_type_id,
  atd.action_tracker_name,
  atd.action_type,
  atd.tracking_method,
  SUM(COALESCE(cf.conversion_count, 1)) AS conversions
FROM conversion_fact cf
LEFT JOIN action_tracker_dim atd
  ON atd.id = cf.action_tracker_dim_id
WHERE cf.campaign_id = 27471
  AND cf.event_datetime >= '2025-11-15'
  AND cf.event_datetime <  '2025-11-23'
GROUP BY
  event_day,
  event_type_id,
  atd.action_tracker_name,
  atd.action_type,
  atd.tracking_method
ORDER BY
  event_day,
  conversions DESC;
