-- DRAFT: bucket errors (needs peer review before saving)
SELECT
  COALESCE(JSON_EXTRACT_PATH_TEXT(err, 'type'),'none') AS error_type,
  COALESCE(JSON_EXTRACT_PATH_TEXT(err, 'msg'),'none')  AS error_msg,
  COUNT(*) AS events
FROM (
  SELECT JSON_PARSE(REPLACE(REPLACE(error_json,'[',''),']','')) AS err
  FROM ir_api_log
  WHERE iram_account_id=4984840
    AND doe >= '2025-11-11' AND doe < '2025-11-12'
    AND error_json IS NOT NULL
) t
GROUP BY 1,2
ORDER BY events DESC;
