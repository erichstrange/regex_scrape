-- REI Product Boost â€“ Clean Audit CSV with item_campaign_id
-- DS: r_ds_iraction_sharded

SELECT
  advertiser_id,
  campaign_id,
  publisher_id               AS media_partner_id,
  action_id,
  oid,
  CONCAT(oid, '_c')          AS new_oid_for_resubmit,
  action_date                AS action_datetime_utc,
  sku,
  quantity,
  adv_saleamt                AS item_adv_sale_amount,
  adv_currency,
  payout_trace,
  item_campaign_id,          -- <=== NEW

  -- mark boost-eligible lines
  CASE
    WHEN (oid = 'A385560474' AND sku = '2399930003') THEN 1
    WHEN (oid = 'A385595006' AND sku = '2130310001') THEN 1
    WHEN (oid = 'A385443249' AND sku = '2404130003') THEN 1
    WHEN (oid = 'A385633257' AND sku = '2389770002') THEN 1
    WHEN (oid = 'A385643176' AND sku = '2397930003') THEN 1
    WHEN (oid = 'A385648053' AND sku = '2396240003') THEN 1
    WHEN (oid = 'A385659112' AND sku = '1996680001') THEN 1
    WHEN (oid = 'A385710403' AND sku = '2399920003') THEN 1
    WHEN (oid = 'A385720943' AND sku = '2255980003') THEN 1
    ELSE 0
  END AS boost_category_flag,

  -- expected boosted commission only for boost-eligible rows
  CASE
    WHEN (oid = 'A385560474' AND sku = '2399930003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385595006' AND sku = '2130310001') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385443249' AND sku = '2404130003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385633257' AND sku = '2389770002') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385643176' AND sku = '2397930003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385648053' AND sku = '2396240003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385659112' AND sku = '1996680001') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385710403' AND sku = '2399920003') THEN ROUND(adv_saleamt * 0.20, 2)
    WHEN (oid = 'A385720943' AND sku = '2255980003') THEN ROUND(adv_saleamt * 0.20, 2)
    ELSE NULL
  END AS expected_boost_commission,

  4018 AS product_boost_campaign_id

FROM irac_action2
WHERE advertiser_id = 3622523
  AND campaign_id   = 17195
  AND oid IN ('A385560474','A385595006','A385443249','A385633257','A385643176',
              'A385648053','A385659112','A385710403','A385720943')
  -- drop negative adjustment rows; we want the positive sale line
  AND NOT (quantity < 0 OR adv_saleamt < 0)
ORDER BY action_date, action_id, sku;
