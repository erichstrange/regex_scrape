-- DRAFT – First conversion date for the new event types
-- Datasource: singlestore (TS), conversions

SELECT
  cf.action_tracker_id           AS event_type_id,
  atd.action_tracker_name,
  MIN(DATE(cf.event_datetime))   AS first_event_day,
  MAX(DATE(cf.event_datetime))   AS last_event_day,
  SUM(COALESCE(cf.conversion_count, 1)) AS total_conversions
FROM conversion_fact cf
LEFT JOIN action_tracker_dim atd
  ON atd.id = cf.action_tracker_dim_id
WHERE cf.campaign_id = 27471
  AND cf.action_tracker_id IN (57037, 57038, 57039)
  AND cf.event_datetime >= '2025-01-01'
  AND cf.event_datetime <  '2025-12-01'
GROUP BY
  cf.action_tracker_id,
  atd.action_tracker_name
ORDER BY first_event_day;


-- DRAFT – 60 days of conversions by day & event type
-- Datasource: singlestore (TS), conversions

SELECT
  DATE(cf.event_datetime)              AS event_day,
  cf.action_tracker_id                 AS event_type_id,
  atd.action_tracker_name,
  SUM(COALESCE(cf.conversion_count, 1)) AS conversions
FROM conversion_fact cf
LEFT JOIN action_tracker_dim atd
  ON atd.id = cf.action_tracker_dim_id
WHERE cf.campaign_id = 27471
  AND cf.event_datetime >= '2025-10-01'
  AND cf.event_datetime <  '2025-12-01'
GROUP BY
  event_day,
  cf.action_tracker_id,
  atd.action_tracker_name
ORDER BY
  event_day,
  conversions DESC;


-- DRAFT – 18 Nov revenue/commission by event type
-- Datasource: singlestore (TS), conversions

SELECT
  af.action_tracker_id         AS event_type_id,
  atr.action_tracker_name,
  COUNT(*)                     AS actions,
  SUM(af.adv_saleamt)          AS total_sale_amount,
  SUM(af.adv_commission)       AS total_commission,
  SUM(af.adv_original_commission) AS total_original_commission
FROM action_fact af
LEFT JOIN action_tracker_dim atr
  ON atr.id = af.action_tracker_dim_id
WHERE af.campaign_id = 27471
  AND af.action_datetime >= '2025-11-18'
  AND af.action_datetime <  '2025-11-19'
GROUP BY
  af.action_tracker_id,
  atr.action_tracker_name
ORDER BY actions DESC;
