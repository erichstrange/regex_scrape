-- Conversions in the UI date range
WITH convs AS (
  SELECT
    conversion_event_id,
    MAX(CASE WHEN event_type = 'Conversion' THEN event_datetime END) AS conversion_time
  FROM radius_path_event_fact
  WHERE advertiser_id = 5823337
    AND conversion_event_datetime >= '2025-10-09'
    AND conversion_event_datetime <  '2025-10-23'
  GROUP BY conversion_event_id
),
-- Conversions where Creative Clicks NA participated anywhere on the path
part_paths AS (
  SELECT DISTINCT conversion_event_id
  FROM radius_path_event_fact
  WHERE advertiser_id = 5823337
    AND event_media_id = 6221153
    AND conversion_event_datetime >= '2025-10-09'
    AND conversion_event_datetime <  '2025-10-23'
),
-- Earliest touch on the entire path (not just the partner)
path_start AS (
  SELECT conversion_event_id, MIN(event_datetime) AS first_event_time
  FROM radius_path_event_fact
  WHERE advertiser_id = 5823337
    AND conversion_event_id IN (SELECT conversion_event_id FROM part_paths)
  GROUP BY conversion_event_id
)
SELECT
  c.conversion_event_id,
  TIMESTAMPDIFF(DAY, ps.first_event_time, c.conversion_time) AS path_days
FROM convs c
JOIN path_start ps USING (conversion_event_id)
ORDER BY path_days DESC
LIMIT 100;
