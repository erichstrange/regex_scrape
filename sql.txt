-- If you’re unsure of the exact table name, run the introspection first (below).
SELECT p.psi, p.radiuscampaign_id
FROM icee_snapshot.program p
WHERE p.radiuscampaign_id = 25438;


-- What ICEE tables exist here?
SHOW TABLES FROM icee_snapshot;

-- What columns does the program table have?
SHOW COLUMNS FROM icee_snapshot.program;


/* DRAFT: ICEE relationships for MobileX around the creation dates.
   These rows back the Prospects grid. We pull raw `source` and creator stamps. */
SELECT
  r.rsi,
  r.supply_psi,
  r.demand_psi,
  r.state,
  r.source,           -- raw source that the UI maps to "Other"
  r.doe,              -- created timestamp (date of entry)
  r.dlu,              -- last update timestamp
  r.uoe,              -- created by (often a service or username)
  r.ulu               -- last updated by
FROM icee_snapshot.relationship r
WHERE r.supply_psi = (:SUPPLY_PSI)             -- paste the PSI from step 1
  AND r.doe >= '2025-10-15' AND r.doe < '2025-11-01'
ORDER BY r.doe DESC;


/* DRAFT: Any partnership recommendations tied to MobileX’s program near the dates?
   Includes fields that identify WHO recommended/vetted and HOW (bulk_upload). */
SELECT
  rec.id                                AS recommendation_id,
  rec.iram_advertiser_id,
  rec.ircm_campaign_id,
  rec.iram_publisher_id                 AS publisher_id,
  rec.recommendation_source,            -- ALGORITHM / USER / PUBLISHER / BRAND / AGENCY ...
  rec.recommendation_by,                -- user if USER-sourced
  rec.vetted_by,                        -- user who vetted AI picks
  rec.bulk_upload,                      -- 1 indicates batch import
  rec.introduction_made_by,
  rec.interest_sent_by,
  rec.doe,                              -- created timestamp
  rec.uoe,                              -- created by (user/service)
  rec.ulu                               -- last updated by
FROM iop.iop_partnership_recommendation rec
WHERE rec.iram_advertiser_id = 5475947
  AND rec.ircm_campaign_id   = 25438
  AND rec.doe >= '2025-10-15' AND rec.doe < '2025-11-01'
ORDER BY rec.doe DESC;


/* DRAFT: map usernames to people (name/email). */
SELECT eu.username,
       eu.email         AS email_address,
       eu.firstname     AS first_name,
       eu.lastname      AS last_name
FROM   iram.core_estaleauser eu
WHERE  eu.username IN (
  -- paste distinct usernames from r.uoe / r.ulu / rec.recommendation_by / rec.vetted_by
);


-- Introspection: find likely tables that log prospect/relationship events.
SELECT table_schema, table_name
FROM information_schema.columns
WHERE table_schema = 'partnerships'
  AND column_name IN ('relationship_id','prospect_id','source','created_by','doe','uoe','ulu')
GROUP BY table_schema, table_name
ORDER BY table_name;
