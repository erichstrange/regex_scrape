-- Conversions by day (presence/volume)
SELECT DATE(event_datetime) AS day, COUNT(*) AS actions
FROM conversion_fact
WHERE advertiser_id = 30720
  AND event_datetime >= DATE_SUB('2025-11-01', INTERVAL 90 DAY)
  AND event_datetime <  '2025-11-01'
GROUP BY day
ORDER BY day;


SELECT DATE(action_datetime) AS day, COUNT(*) AS actions
FROM action_fact
WHERE advertiser_id = 30720
  AND action_datetime >= '2025-10-01'
  AND action_datetime <  '2025-11-01'
GROUP BY day
ORDER BY day;


SELECT COUNT(*) AS actions_oct
FROM conversion_fact
WHERE advertiser_id = 30720
  AND p_event_date_ym = 202510;          -- helps partition pruning


-- Count with/without code in one pass
SELECT
  SUM(CASE WHEN promo_code IS NULL OR promo_code='' THEN 1 ELSE 0 END) AS without_code,
  SUM(CASE WHEN promo_code IS NOT NULL AND promo_code<>'' THEN 1 ELSE 0 END) AS with_code,
  COUNT(*) AS total_actions
FROM conversion_fact
WHERE advertiser_id = 30720
  AND event_datetime >= '2025-10-01'
  AND event_datetime <  '2025-11-01';
