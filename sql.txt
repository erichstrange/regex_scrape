-- Click detail for Crocs US + YeahPromos in Sep 2025
-- [Datasource: singlestore]  (vetted query pattern)
SELECT
  cf.campaign_id,
  cf.event_datetime,
  JSON_EXTRACT_STRING(cf.json,'inboundLink') AS tracking_link,
  cf.click_id, cf.profile_id,
  ad.ad_id, ad.name AS ad_name,
  JSON_EXTRACT_STRING(cf.json,'blockingRule') AS blocking_rule,
  JSON_EXTRACT_STRING(cf.json,'ruleName')     AS rule_name,
  cf.landing_page_url,
  cf.pub_subid1, cf.pub_subid2, cf.pub_subid3, cf.pub_subid4,
  cf.method, cf.classification
FROM click_fact cf
LEFT JOIN ad_dim ad ON cf.ad_dim_id = ad.id
WHERE advertiser_id = 1211624            -- Crocs US (adv/account id)
  AND cf.publisher_id = 3311071           -- YeahPromos (from your screenshot)
  AND event_datetime >= '2025-09-01'
  AND event_datetime <  '2025-10-01'
ORDER BY cf.event_datetime DESC;



-- Actions with referral context for Sep 2025
-- [Datasource: irdw_imp (singlestore path)]  (vetted query pattern)
SELECT
   af.action_datetime, af.advertiser_id, af.campaign_id, af.action_id,
   af.publisher_id, atr.action_tracker_name, atr.action_tracker_id,
   af.batch_id, af.oid,
   SUBSTRING_INDEX(SUBSTRING(af.ref_landingpage_url, LOCATE('irclickid=', af.ref_landingpage_url) + 10), '&', 1) AS irclickid,
   af.pubsubid1, af.pubsubid2, af.pubsubid3, af.pubsubid4,
   ad.ad_id, ad.name AS ad_name,
   af.ref_url, af.ref_domain, af.ref_landingpage_url,
   af.ref_profile_id, af.conv_profile_id
FROM action_fact af
LEFT JOIN action_tracker_dim atr ON action_tracker_dim_id = atr.id
LEFT JOIN ad_dim ad            ON ad.id = af.ref_ad_dim_id
WHERE af.advertiser_id = 1211624
  AND af.publisher_id  = 3311071
  AND af.action_datetime >= '2025-09-01'
  AND af.action_datetime <  '2025-10-01'
ORDER BY af.action_datetime DESC;



-- Path for a given conversion (sample suspicious ones from #2)
-- [Datasource: r_ds_singlestore]
SELECT event_id, event_type, event_datetime, event_media_id, event_media_dim_id,
       md.media_name, md.media_type, md.media_channel_name,
       referral_ad_type, referring_url, click_order_first_to_last,
       referral_is_winner, referral_is_introducer, referral_is_influencer, referral_is_closer
FROM radius_path_event_fact rpef
JOIN media_dim md ON md.id = rpef.event_media_dim_id
WHERE rpef.campaign_id = <Crocs campaign_id>
  AND conversion_event_id = '<A-... from #2>'
ORDER BY click_order_first_to_last;



-- Raw action table record(s) by action_id + campaign_id
-- [Datasource: iraction_sharded]
select action_id, action_date, action_type, campaign_id, action_tracker_id, oid,
       publisher_id, payout_trace, ref_profile_id, ref_url, ref_domain,
       pub_subid1, pub_subid2, pub_subid3, pub_subid4, ref_user_agent
from irac_action2
where action_id in ('<one or more action_id from #2>')
  and campaign_id = '<Crocs campaign_id>';


-- Devices & UA for specific OIDs (weâ€™ll pivot by action_datetime)
-- [Datasource: irdw_imp / singlestore]
SELECT oid, action_id,
       platform AS device, device_family AS device_type,
       os_name AS OS, ua_name AS User_Agent
FROM action_fact
WHERE advertiser_id = 1211624
  AND publisher_id  = 3311071
  AND action_datetime >= '2025-09-01'
  AND action_datetime <  '2025-10-01';


-- Any scheduled terms that could have gone live in Sep for Crocs US
-- [Datasource: ircm]
SELECT ins.name AS template_term_name, st.name AS scheduled_term_name,
       st.start_date, st.end_date
FROM ircm_scheduled_terms st
JOIN ircm_insertionorder ins ON ins.id = st.ircm_insertionorder_id
WHERE st.ircm_campaign_id = <Crocs campaign_id>
  AND st.start_date >= '2025-08-25' AND st.start_date < '2025-10-05'
ORDER BY st.start_date DESC;
