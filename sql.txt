-- PROGRAMS for Advertiser 5475947
SELECT id            AS program_id,
       name,
       state
FROM   ircm.ircm_campaign
WHERE  iram_advertiser_id = 5475947
AND    state IN ('ACTIVE','AWAITING_REVIEW','SETUP_COMPLETED','DELINQUENT')
ORDER BY id;


-- PSI mapping for those programs
SELECT p.radiuscampaign_id AS program_id,
       p.psi
FROM   icee.program p
WHERE  p.radiuscampaign_id IN (/* paste program_id(s) from step 1 */)
ORDER BY p.radiuscampaign_id;


-- ICEE relationships created for the brand (these show up as Prospects)
SELECT r.rsi,
       r.supply_psi,
       r.demand_psi,
       r.state,
       r.source,              -- Often surfaces as "Other" in Prospects UI
       r.created_date,        -- try created_on if needed
       r.closed,
       r.closed_date
FROM   icee.relationship r
WHERE  r.supply_psi IN (
         SELECT psi FROM icee.program WHERE radiuscampaign_id IN (/* programs from step 1 */)
       )
AND    r.created_date BETWEEN '2025-10-15' AND '2025-10-31'
ORDER  BY r.created_date DESC;


-- Matchmaking recommendations for those programs in the same window
SELECT rec.id                         AS recommendation_id,
       rec.program_id,                -- or rec.brand_id in some schemas
       rec.iram_publisher_id          AS publisher_id,
       rec.recommendation_source,     -- ALGORITHM / USER / PUBLISHER / BRAND / AGENCY
       rec.vetted_by,                 -- username who vetted AI recs (ties to a person)
       rec.recommended_by,            -- username if USER/â€¦ source
       rec.created_on
FROM   iop.iop_partnership_recommendation rec
WHERE  rec.program_id IN (/* programs from step 1 */)
AND    rec.created_on BETWEEN '2025-10-15' AND '2025-10-31'
ORDER  BY rec.created_on DESC;


-- Map Operator usernames to a person (name/email)
SELECT eu.username,
       emp.first_name,
       emp.last_name,
       eu.email_address,
       op.id AS operator_id
FROM   iram.core_estaleauser eu
LEFT   JOIN iram.iram_employee  emp ON emp.contact_id = eu.contact_id
LEFT   JOIN iram.iram_operator  op  ON op.contact_id  = eu.contact_id
WHERE  eu.username IN (/* paste vetted_by / recommended_by from step 4 */)
ORDER  BY eu.username;
