SELECT
  pd.publisher_name,
  COUNT(*) AS total_clicks,
  SUM(CASE WHEN cf.classification = 'D' THEN 1 ELSE 0 END) AS duplicate_clicks,
  SUM(CASE WHEN cf.classification = 'E' THEN 1 ELSE 0 END) AS excluded_clicks,
  SUM(CASE WHEN cf.classification = 'B' THEN 1 ELSE 0 END) AS bot_clicks,
  SUM(
    CASE
      WHEN JSON_UNQUOTE(JSON_EXTRACT(cf.json, '$.orgdc')) = 'DATACENTER'
      THEN 1 ELSE 0
    END
  ) AS datacenter_clicks
FROM click_fact cf
JOIN publisher_dim pd
  ON cf.publisher_id = pd.publisher_id
WHERE cf.event_datetime BETWEEN '2025-11-29' AND '2025-12-10'
  AND cf.campaign_id = 37552
GROUP BY pd.publisher_name
ORDER BY total_clicks DESC;


SELECT
  cf.click_id,
  cf.event_datetime,
  cf.classification,
  JSON_UNQUOTE(JSON_EXTRACT(cf.json, '$.orgdc')) AS orgdc
FROM click_fact cf
WHERE cf.campaign_id = 37552
  AND cf.publisher_id = 36345
  AND cf.event_datetime BETWEEN '2025-11-29' AND '2025-12-10'
ORDER BY cf.event_datetime;


SELECT
  b.ircm_campaign_id,
  b.rule_name,
  b.rule_json,
  b.action,
  b.doe,
  b.dlu
FROM ircm_blockredirect b
WHERE b.action = 'EXCLUDE';
