/* DRAFT â€” for peer review before use */
SELECT
    content.id                               AS ad_id,                 -- the Ad ID you need
    content.iram_account_id                  AS account_id,
    content.ircm_campaign_id                 AS campaign_id,
    policy.name                              AS policy_name,
    website.domains                          AS domain,
    ad.ad_description,
    ad.iram_mediapartner_id                  AS tsm_partner_id,
    ad.partner_type,
    content.doe
FROM icomp.compliance_paid_search_ad              ad
JOIN icomp.compliance_content                     content ON content.id = ad.compliance_content_id
JOIN icomp.compliance_website                     website ON website.id = content.website_id
JOIN icomp.compliance_paid_search_ad_policy       policy  ON policy.id = ad.compliance_paid_search_ad_policy_id
WHERE content.ircm_campaign_id = 5644
  AND website.domains LIKE '%discountsclubs.com%'
  AND content.doe BETWEEN '2025-10-20' AND '2025-10-28'
ORDER BY content.doe DESC;

+-------+------------+-------------+-------------+--------+----------------+----------------+--------------+-----+
| ad_id | account_id | campaign_id | policy_name | domain | ad_description | tsm_partner_id | partner_type | doe |
+-------+------------+-------------+-------------+--------+----------------+----------------+--------------+-----+
+-------+------------+-------------+-------------+--------+----------------+----------------+--------------+-----+



select ad.compliance_content_id as ad_id
     , content.iram_account_id as account_id
     , content.ircm_campaign_id as campaign_id
     , ad.ad_description
     , case when ad.iram_mediapartner_id = 0 then 'No Partner Data' else ad.iram_mediapartner_id end as partner_id
     , ad.partner_type
     , policy.id as policy_id
     , policy.name as policy_name
     , website.domains as domain
     , cbi.payload as third_party_provider_data   -- JSON from TSM
     , cbi.response as processing_info
from icomp.compliance_paid_search_ad_policy policy
join icomp.compliance_paid_search_ad ad
  on ad.compliance_paid_search_ad_policy_id = policy.id
join icomp.compliance_content content
  on content.id = ad.compliance_content_id
join icomp.compliance_website website
  on website.id = content.website_id
join icomp.compliance_batch_item_content cbic
  on cbic.compliance_content_id = content.id
join icomp.compliance_batch_item cbi
  on cbi.id = cbic.compliance_batch_item_id
where ad.compliance_content_id = <Ad ID>;
