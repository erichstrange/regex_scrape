SELECT u.id,
       ce.username,
       ce.email,
       ce.firstname,
       ce.lastname,
       u.state,
       ce.lastlogin_date,
       ce.doe,
       ce.dlu,
       ce.uoe,
       ce.ulu
FROM iram_usership u
JOIN core_estaleauser ce
  ON u.account_user_id = ce.id
WHERE u.irAccount_Id = "6613564"
ORDER BY ce.lastlogin_date DESC;


SELECT ce.id,
       ce.firstname,
       ce.lastname,
       iu.state,
       ce.email,
       ce.username
FROM core_estaleauser ce
JOIN userconnection uc ON ce.username = uc.userID
JOIN iram_usership iu ON ce.id = iu.account_user_id
WHERE iu.state = 'active'
  AND irAccount_id = 6613564;


SELECT *
FROM core_role
WHERE id IN (
  SELECT core_role_id
  FROM core_ap_role
  WHERE core_ap_id = (
    SELECT authorizationPrincipal_id
    FROM iram_usership
    WHERE account_user_id = <account_user_id>
      AND irAccount_id     = 6613564
  )
);


SELECT *
FROM core_permission
WHERE id IN (
  SELECT core_permission_id
  FROM core_role_permission
  WHERE core_role_id = (
    SELECT id
    FROM core_role
    WHERE name = "Advertiser Management"
  )
);


-- Search for any Template-Term-related permissions/roles
SELECT *
FROM core_permission
WHERE name LIKE '%Template%' OR code LIKE '%TEMPLATE%';

-- Given role IDs from Goal 2, expand to permissions:
SELECT cp.*
FROM core_permission cp
JOIN core_role_permission rp
  ON rp.core_permission_id = cp.id
WHERE rp.core_role_id IN (<comma_separated_role_ids>);
