-- Vetted: Advertiser â€“ Contract Timezones (focus on Public Terms, activation second)
SELECT
  it.iram_advertiser_id,
  io.name,
  it.timezone,
  it.active_start_date,
  it.active_end_date,
  io.ulu
FROM ircm_ioterms AS it
LEFT JOIN ircm_insertionorder AS io
  ON it.iram_advertiser_id = io.iram_advertiser_id
WHERE ircm_campaign_id = 4318
  AND io.name = 'Public Terms'
  AND it.active_start_date >= '2025-10-02 18:57:00'
  AND it.active_start_date <  '2025-10-02 18:58:00'
ORDER BY it.active_start_date DESC;



-- Vetted base + filters to find the prior human actor
SELECT
  it.iram_advertiser_id,
  io.name,
  it.timezone,
  it.active_start_date,
  it.active_end_date,
  io.ulu
FROM ircm_ioterms AS it
LEFT JOIN ircm_insertionorder AS io
  ON it.iram_advertiser_id = io.iram_advertiser_id
WHERE ircm_campaign_id = 4318
  AND io.name = 'Public Terms'
  AND it.active_start_date <  '2025-10-02 18:57:33'      -- strictly *before* the activation moment
  AND io.ulu NOT LIKE 'UpcomingContractProcessor%'       -- exclude the system job
ORDER BY it.active_start_date DESC
LIMIT 1;                                                 -- the most recent human just before go-live
