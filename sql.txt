SELECT DISTINCT p.id, p.name, p.code
FROM core_ap_role ar
JOIN core_role_permission rp ON rp.core_role_id = ar.core_role_id
JOIN core_permission p       ON p.id = rp.core_permission_id
WHERE ar.core_ap_id = (
  SELECT authorizationPrincipal_id
  FROM iram_usership
  WHERE irAccount_id = 6613564
)
AND p.code IN (
  'PERMISSION_PARTNER_MANAGER_MANAGE_INSERTION_ORDERS',
  'PERMISSION_PARTNER_MANAGER_MANAGE_INSERTION_ORDER_RULES',
  'PERMISSION_PARTNER_MANAGER_VIEW_INSERTION_ORDERS',
  'PERMISSION_PARTNER_MANAGER_TEMPLATE_TERMS_ADMINISTRATOR'
)
ORDER BY p.id;


SELECT DISTINCT r.id AS role_id, r.name AS role_name
FROM core_role r
JOIN core_role_permission rp ON rp.core_role_id = r.id
JOIN core_permission p       ON p.id = rp.core_permission_id
WHERE p.code IN (
  'PERMISSION_PARTNER_MANAGER_MANAGE_INSERTION_ORDERS',
  'PERMISSION_PARTNER_MANAGER_MANAGE_INSERTION_ORDER_RULES',
  'PERMISSION_PARTNER_MANAGER_VIEW_INSERTION_ORDERS',
  'PERMISSION_PARTNER_MANAGER_TEMPLATE_TERMS_ADMINISTRATOR'
)
ORDER BY r.name;


SELECT
  ce.id,
  ce.firstname,
  ce.lastname,
  iu.state,
  ce.email,
  ce.username,
  (uc.userID IS NOT NULL) AS has_userconnection
FROM iram_usership iu
JOIN core_estaleauser ce
  ON iu.account_user_id = ce.id
LEFT JOIN userconnection uc
  ON ce.username = uc.userID           -- keep LEFT JOIN unless you truly require a uc row
WHERE iu.irAccount_id = 6613564        -- prefer numeric (no quotes) for an INT column
  AND UPPER(iu.state) = 'ACTIVE';



SELECT 1
FROM core_ap_role ar
JOIN core_role r ON r.id = ar.core_role_id
WHERE ar.core_ap_id = (
  SELECT authorizationPrincipal_id
  FROM iram_usership
  WHERE irAccount_id = 6613564
)
AND r.name = 'Advertiser Management';


SELECT p.id, p.name, p.code, p.permissionType
FROM core_role r
JOIN core_role_permission rp ON rp.core_role_id = r.id
JOIN core_permission p       ON p.id = rp.core_permission_id
WHERE r.name = 'Advertiser System Role'
ORDER BY p.permissionType, p.code;
