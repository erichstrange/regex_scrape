/* DRAFT - TS - Pixel Order Processing Latency (Internal Only)
   Datasource: r_ds_singlestore
   Table: datalake_irdwm.action_fact
*/
Internal-only lookup for a single order action in action_fact.
Given advertiser, campaign, action ID, and a narrow action date range, returns conversion time, AP processed time, last adjustment time, and latency in minutes.
For TS/CS internal use only – not exposed to customers.
SELECT
    advertiser_id                                  AS advertiser_id,
    campaign_id                                    AS campaign_id,
    oid                                            AS oid,
    action_id                                      AS action_id,
    action_datetime                                AS ConversionDateTime_UTC,
    doe                                            AS APProcessedDateTime_UTC,
    adj_datetime                                   AS LastAdjustmentDateTime_UTC,
    TIMESTAMPDIFF(
        MINUTE,
        action_datetime,
        doe
    )                                              AS APProcessingLatency_Minutes
FROM
    action_fact
WHERE
    advertiser_id      = [[ADVERTISER_ID]]
    AND campaign_id    = [[CAMPAIGN_ID]]
    AND action_id      = [[ACTION_ID]]
    AND action_datetime BETWEEN [[ACTION_START_DATETIME]]
                           AND [[ACTION_END_DATETIME]]
ORDER BY
    action_datetime DESC;




/* DRAFT - TS - FTP Submission Log Lookup (Internal Only)
   Datasource: r_ds_ods
   Table: ir_ftp_batch_log
*/

Internal-only lookup of FTP batch submissions for a given account.
Shows when FTP files were submitted to Impact (submit_date) so TS/CS can compare FTP submit timing with AP processing timing in the pixel latency report.
For TS/CS only – not customer-facing.

SELECT
    iram_account_id,
    batch_id,
    submit_date
FROM
    ir_ftp_batch_log
WHERE
    iram_account_id = [[ACCOUNT_ID]]
    AND submit_date BETWEEN [[SUBMIT_START_DATETIME]]
                         AND [[SUBMIT_END_DATETIME]]
    -- Optional extra narrow filter if needed:
    -- AND batch_id = [[BATCH_ID]]
ORDER BY
    submit_date DESC
LIMIT 500;



/* DRAFT - TS - API Submission Log Lookup (Internal Only)
   Datasource: r_ds_ods
   Table: ir_api_log
   NOTE: Column names (oid, doe) must be verified in QA/with Wade before broad use.
*/
Internal-only lookup of API submissions for a given account and order ID.
Shows when the API request was logged (doe) so TS/CS can compare API submission timing with AP processing timing in the pixel latency report.
For TS/CS only – not exposed to customers.
SELECT
    *
FROM
    ir_api_log
WHERE
    iram_account_id = [[ACCOUNT_ID]]
    AND doe BETWEEN [[API_START_DATETIME]]
                AND [[API_END_DATETIME]]
    AND oid = [[ORDER_ID]]
ORDER BY
    doe DESC
LIMIT 500;
