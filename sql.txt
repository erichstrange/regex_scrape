-- [SingleStore] Click logs with exact inbound URLs & rule hits
SELECT
  cf.event_datetime,
  cf.click_id,
  JSON_EXTRACT_STRING(cf.json,'inboundLink') AS inbound_link,
  ad.ad_id, ad.name AS ad_name,
  cf.publisher_id, cf.landing_page_url,
  JSON_EXTRACT_STRING(cf.json,'ruleName')     AS rule_name,
  JSON_EXTRACT_STRING(cf.json,'blockingRule') AS blocking_rule
FROM click_fact cf
LEFT JOIN ad_dim ad ON cf.ad_dim_id = ad.id
WHERE cf.campaign_id  = 9488                            -- TFD
  AND cf.publisher_id IN (34844 /*Cartera*/, 10579 /*Rakuten*/)
  AND cf.event_datetime BETWEEN '2025-09-22' AND '2025-09-30'
ORDER BY cf.event_datetime DESC;


SELECT cf.publisher_id, COUNT(*) AS clicks,
       MIN(cf.event_datetime) AS first_seen, MAX(cf.event_datetime) AS last_seen
FROM click_fact cf
WHERE cf.campaign_id = 9488
  AND cf.landing_page_url LIKE '%/p/rakutendpd%'
  AND cf.event_datetime >= DATE_SUB(NOW(), INTERVAL 60 DAY)
GROUP BY cf.publisher_id
ORDER BY clicks DESC;


SELECT af.oid, af.publisher_id,
       ad.ad_id AS stamped_ad_id, ad.name AS stamped_ad_name,
       af.ref_landingpage_url, af.ref_domain
FROM action_fact af
LEFT JOIN ad_dim ad ON ad.id = af.ref_ad_dim_id
WHERE af.campaign_id = 9488
  AND af.action_datetime BETWEEN '2025-09-22' AND '2025-09-30'
ORDER BY af.action_datetime DESC;
