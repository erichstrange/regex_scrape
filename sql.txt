-- [r_ds_singlestore] OurRitual (Campaign 24744) - status counts, pre/post Sep 16, 2025
SELECT
  CASE WHEN conversion_event_datetime < '2025-09-16' THEN 'Pre-2025-09-16'
       ELSE 'Post-2025-09-16' END AS period,
  conversion_status,
  COUNT(*) AS actions
FROM radius_path_event_fact
WHERE campaign_id = 24744
  AND conversion_event_datetime >= '2025-09-01'
  AND conversion_event_datetime <  '2025-11-05'  -- today+1
GROUP BY period, conversion_status
ORDER BY period, conversion_status;


-- [r_ds_singlestore] Reversed actions, PRE Sep 16 window
SELECT
  conversion_event_datetime AS action_datetime,
  conversion_event_id       AS action_id,
  conversion_oid            AS oid,
  conversion_status,
  conversion_action_tracker_id,
  event_url
FROM radius_path_event_fact
WHERE campaign_id = 24744
  AND conversion_event_datetime >= '2025-09-01'
  AND conversion_event_datetime <  '2025-09-17'
  AND conversion_status = 'REVERSED'
ORDER BY action_datetime DESC;


-- [r_ds_singlestore] Reversed actions, POST Sep 16 window
SELECT
  conversion_event_datetime AS action_datetime,
  conversion_event_id       AS action_id,
  conversion_oid            AS oid,
  conversion_status,
  conversion_action_tracker_id,
  event_url
FROM radius_path_event_fact
WHERE campaign_id = 24744
  AND conversion_event_datetime >= '2025-09-17'
  AND conversion_event_datetime <  '2025-11-05'
  AND conversion_status = 'REVERSED'
ORDER BY action_datetime DESC;


-- [r_ds_singlestore] All actions (any status), Oct 1 -> Nov 4 for current view
SELECT
  conversion_event_datetime AS action_datetime,
  conversion_event_id       AS action_id,
  conversion_oid            AS oid,
  conversion_status,
  conversion_action_tracker_id,
  event_url
FROM radius_path_event_fact
WHERE campaign_id = 24744
  AND conversion_event_datetime >= '2025-10-01'
  AND conversion_event_datetime <  '2025-11-05'
ORDER BY action_datetime DESC
LIMIT 1000;


-- [iraction_sharded] OurRitual actions (all statuses), Sep 1 -> Nov 4
SELECT
  action_date,
  doe,
  action_id,
  action_tracker_id,
  oid,
  new_status,
  adj_reason,
  batch_id,
  ref_url,
  ref_domain
FROM irac_action2
WHERE campaign_id = 24744
  AND action_date >= '2025-09-01'
  AND action_date <  '2025-11-05'
ORDER BY action_date DESC
LIMIT 2000;


-- [r_ds_iraction_general] Same pull if 'iraction_sharded' isn't available
SELECT
  action_date,
  doe,
  action_id,
  action_tracker_id,
  oid,
  new_status,
  adj_reason,
  batch_id,
  ref_url,
  ref_domain
FROM irac_action2
WHERE campaign_id = 24744
  AND action_date >= '2025-09-01'
  AND action_date <  '2025-11-05'
ORDER BY action_date DESC
LIMIT 2000;


-- [actionlogging_sharded] No-referrer events for OurRitual (sanity check)
SELECT *
FROM ir_noreferrer_event
WHERE campaign_id = 24744
  AND doe >= '2025-09-01'
  AND doe <  '2025-11-05'
ORDER BY doe DESC
LIMIT 200;
