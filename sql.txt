-- r_ds_icee_snapshot
SHOW COLUMNS FROM sync_ircm_ircm_campaign LIKE '%psi%';


-- r_ds_icee_snapshot
SELECT id AS ircm_campaign_id, program_psi
FROM sync_ircm_ircm_campaign
WHERE id = 25438;
-- Expect exactly 1 row. We'll call that value supply_psi for the next step.


-- r_ds_icee_snapshot  (DRAFT)
-- Replace r.doe bounds if you need a wider window.
SELECT
  BIN_TO_UUID(r.rsi, 1)                 AS relationship_id,
  BIN_TO_UUID(r.supply_psi, 1)          AS brand_supply_psi,
  BIN_TO_UUID(r.demand_psi, 1)          AS partner_demand_psi,
  rst.name                               AS source_type,             -- this is what UI maps to "Source"
  rstat.name                             AS relationship_state,      -- (open/prospect/closed/etc.)
  r.doe                                  AS created_utc,             -- created timestamp
  r.uoe                                  AS created_by_username,     -- who inserted (user/service)
  r.ulu                                  AS last_updated_by_username
FROM relationship r
JOIN relationship_source_type rst
  ON rst.id = r.relationship_source_type_id
JOIN relationship_state_type rstat
  ON rstat.id = r.relationship_state_type_id
JOIN (
  SELECT program_psi
  FROM sync_ircm_ircm_campaign
  WHERE id = 25438
) x
  ON r.supply_psi = x.program_psi
WHERE r.doe >= '2025-10-15' AND r.doe < '2025-11-01'
ORDER BY r.doe DESC;
