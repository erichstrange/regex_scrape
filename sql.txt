-- Failures by day (all H&R event types)
SELECT action_tracker_id,
       DATE(doe) AS day,
       COUNT(*)  AS failures
FROM ir_failure_event
WHERE advertiser_id = 407482
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND doe >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND doe < NOW()
GROUP BY action_tracker_id, DATE(doe)
ORDER BY action_tracker_id, day;


-- Failures by day + error_code (drilldown)
SELECT action_tracker_id,
       DATE(doe) AS day,
       IFNULL(error_code,'') AS error_code,
       COUNT(*) AS failures
FROM ir_failure_event
WHERE advertiser_id = 407482
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND doe >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND doe < NOW()
GROUP BY action_tracker_id, DATE(doe), error_code
ORDER BY action_tracker_id, day, error_code;


-- 24236 spotlight (detail: you will see "oid missing" rows if pixel fallback lacks orderId)
SELECT *
FROM ir_failure_event
WHERE advertiser_id = 407482
  AND action_tracker_id = 24236
  AND doe >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND doe < NOW()
ORDER BY doe DESC
LIMIT 200;


-- No‑referrers by day (all H&R event types)
SELECT action_tracker_id,
       DATE(doe) AS day,
       COUNT(*)  AS norefs
FROM ir_noreferrer_event
WHERE campaign_id = 5683
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND doe >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND doe < NOW()
GROUP BY action_tracker_id, DATE(doe)
ORDER BY action_tracker_id, day;


-- 24236 no‑referrer detail (pairs with the failure view)
SELECT *
FROM ir_noreferrer_event
WHERE campaign_id = 5683
  AND action_tracker_id = 24236
  AND doe >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND doe < NOW()
ORDER BY doe DESC
LIMIT 200;


-- Failures by day (BA event types)
SELECT action_tracker_id,
       DATE(doe) AS day,
       COUNT(*)  AS failures
FROM ir_failure_event
WHERE action_tracker_id IN (40062,41815,41816,41817,42474)
  AND doe >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND doe < NOW()
GROUP BY action_tracker_id, DATE(doe)
ORDER BY action_tracker_id, day;


-- No‑referrers by day (BA event types)
SELECT action_tracker_id,
       DATE(doe) AS day,
       COUNT(*)  AS norefs
FROM ir_noreferrer_event
WHERE campaign_id = 21045
  AND action_tracker_id IN (40062,41815,41816,41817,42474)
  AND doe >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND doe < NOW()
GROUP BY action_tracker_id, DATE(doe)
ORDER BY action_tracker_id, day;


SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 12723
  ORDER BY ref_date DESC LIMIT 20
) t1
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 12724
  ORDER BY ref_date DESC LIMIT 20
) t2
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 12725
  ORDER BY ref_date DESC LIMIT 20
) t3
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 12726
  ORDER BY ref_date DESC LIMIT 20
) t4
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 16308
  ORDER BY ref_date DESC LIMIT 20
) t5
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 21326
  ORDER BY ref_date DESC LIMIT 20
) t6
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 21327
  ORDER BY ref_date DESC LIMIT 20
) t7
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 23262
  ORDER BY ref_date DESC LIMIT 20
) t8
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 24236
  ORDER BY ref_date DESC LIMIT 20
) t9
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 43677
  ORDER BY ref_date DESC LIMIT 20
) t10
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 5683 AND action_tracker_id = 51884
  ORDER BY ref_date DESC LIMIT 20
) t11
ORDER BY action_tracker_id, ref_date DESC;



SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 21045 AND action_tracker_id = 40062
  ORDER BY ref_date DESC LIMIT 20
) b1
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 21045 AND action_tracker_id = 41815
  ORDER BY ref_date DESC LIMIT 20
) b2
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 21045 AND action_tracker_id = 41816
  ORDER BY ref_date DESC LIMIT 20
) b3
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 21045 AND action_tracker_id = 41817
  ORDER BY ref_date DESC LIMIT 20
) b4
UNION ALL
SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
FROM (
  SELECT action_tracker_id, ref_date, ref_type, ref_domain, ref_url, ref_profile_id, action_id
  FROM ir_referrer
  WHERE campaign_id = 21045 AND action_tracker_id = 42474
  ORDER BY ref_date DESC LIMIT 20
) b5
ORDER BY action_tracker_id, ref_date DESC;


-- Actions by day & status (all H&R event types)
SELECT action_tracker_id,
       DATE(action_date) AS day,
       action_status,
       COUNT(*) AS actions
FROM irac_action2
WHERE campaign_id = 5683
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND action_date >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND action_date < NOW()
GROUP BY action_tracker_id, DATE(action_date), action_status
ORDER BY action_tracker_id, day, action_status;


-- Last 20 actions PER tracker (combined via UNION ALL; no window functions)
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12723
  ORDER BY action_date DESC LIMIT 20
) a1
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12724
  ORDER BY action_date DESC LIMIT 20
) a2
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12725
  ORDER BY action_date DESC LIMIT 20
) a3
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12726
  ORDER BY action_date DESC LIMIT 20
) a4
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 16308
  ORDER BY action_date DESC LIMIT 20
) a5
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 21326
  ORDER BY action_date DESC LIMIT 20
) a6
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 21327
  ORDER BY action_date DESC LIMIT 20
) a7
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 23262
  ORDER BY action_date DESC LIMIT 20
) a8
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 24236
  ORDER BY action_date DESC LIMIT 20
) a9
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 43677
  ORDER BY action_date DESC LIMIT 20
) a10
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 51884
  ORDER BY action_date DESC LIMIT 20
) a11
ORDER BY action_tracker_id, action_date DESC;


-- Actions by day & status (BA event types)
SELECT action_tracker_id,
       DATE(action_date) AS day,
       action_status,
       COUNT(*) AS actions
FROM irac_action2
WHERE campaign_id = 21045
  AND action_tracker_id IN (40062,41815,41816,41817,42474)
  AND action_date >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND action_date < NOW()
GROUP BY action_tracker_id, DATE(action_date), action_status
ORDER BY action_tracker_id, day, action_status;


-- Last 20 actions PER BA tracker (combined)
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 40062
  ORDER BY action_date DESC LIMIT 20
) b1
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 41815
  ORDER BY action_date DESC LIMIT 20
) b2
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 41816
  ORDER BY action_date DESC LIMIT 20
) b3
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 41817
  ORDER BY action_date DESC LIMIT 20
) b4
UNION ALL
SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, action_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 42474
  ORDER BY action_date DESC LIMIT 20
) b5
ORDER BY action_tracker_id, action_date DESC;




json.campaign:5683 AND json.tracker:12723
json.campaign:5683 AND json.tracker:12724
json.campaign:5683 AND json.tracker:12725
json.campaign:5683 AND json.tracker:12726
json.campaign:5683 AND json.tracker:16308
json.campaign:5683 AND json.tracker:21326
json.campaign:5683 AND json.tracker:21327
json.campaign:5683 AND json.tracker:23262
json.campaign:5683 AND json.tracker:24236
json.campaign:5683 AND json.tracker:43677
json.campaign:5683 AND json.tracker:51884


json.campaign:5683 AND json.event:ConversionSubmission AND json.tracker:12723
json.campaign:5683 AND json.event:ConversionSubmission AND json.tracker:23262


json.campaign:5683 AND error
json.campaign:5683 AND json.tracker:24236 AND error
json.campaign:5683 AND json.tracker:24236 AND error:"oid=oid missing"

json.campaign:5683 AND (json.tracker:12723 OR json.tracker:23262) AND -json.clickid:*
json.campaign:5683 AND json.test:1
