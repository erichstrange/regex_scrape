-- H&R 5683 — total failures by tracker (last 14d)
SELECT action_tracker_id, COUNT(*) AS failures_14d
FROM ir_failure_event
WHERE advertiser_id = 407482
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND doe >= DATE_SUB(NOW(), INTERVAL 14 DAY)
GROUP BY action_tracker_id
ORDER BY failures_14d DESC;


-- H&R 5683 — top failure error codes (last 14d, capped)
SELECT action_tracker_id, IFNULL(error_code,'') AS error_code, COUNT(*) AS cnt
FROM ir_failure_event
WHERE advertiser_id = 407482
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND doe >= DATE_SUB(NOW(), INTERVAL 14 DAY)
GROUP BY action_tracker_id, error_code
ORDER BY cnt DESC
LIMIT 250;


-- BA 21045 — total failures by tracker (last 14d)
SELECT action_tracker_id, COUNT(*) AS failures_14d
FROM ir_failure_event
WHERE action_tracker_id IN (40062,41815,41816,41817,42474)
  AND doe >= DATE_SUB(NOW(), INTERVAL 14 DAY)
GROUP BY action_tracker_id
ORDER BY failures_14d DESC;


-- BA 21045 — top failure error codes (last 14d, capped)
SELECT action_tracker_id, IFNULL(error_code,'') AS error_code, COUNT(*) AS cnt
FROM ir_failure_event
WHERE action_tracker_id IN (40062,41815,41816,41817,42474)
  AND doe >= DATE_SUB(NOW(), INTERVAL 14 DAY)
GROUP BY action_tracker_id, error_code
ORDER BY cnt DESC
LIMIT 250;


SELECT id, action_id, action_date, action_type, action_status, error_code, advertiser_id, campaign_id, action_tracker_id, oid, doe
FROM ir_failure_event
WHERE advertiser_id = 407482
  AND action_tracker_id = 24236
  AND doe >= DATE_SUB(NOW(), INTERVAL 14 DAY)
ORDER BY doe DESC
LIMIT 500;


SELECT f.action_tracker_id, f.action_date, f.oid, r.publisher_id, r.ref_type, r.ref_domain, r.ref_url
FROM ir_failure_event f
LEFT JOIN ir_referrer r ON r.action_id = f.action_id
WHERE f.advertiser_id = 407482
  AND f.doe >= DATE_SUB(NOW(), INTERVAL 7 DAY)
  AND f.action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
ORDER BY f.action_tracker_id, f.action_date DESC
LIMIT 1000;


-- H&R 5683 — actions by day (last 30d)
SELECT action_tracker_id,
       DATE(action_date) AS day,
       COUNT(*) AS actions
FROM irac_action2
WHERE campaign_id = 5683
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND action_date >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND action_date < NOW()
GROUP BY action_tracker_id, DATE(action_date)
ORDER BY action_tracker_id, day;


-- H&R 5683 — actions by day & new_status (last 30d)
SELECT action_tracker_id,
       DATE(action_date) AS day,
       IFNULL(new_status,'') AS new_status,
       COUNT(*) AS actions
FROM irac_action2
WHERE campaign_id = 5683
  AND action_tracker_id IN (12723,12724,12725,12726,16308,21326,21327,23262,24236,43677,51884)
  AND action_date >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND action_date < NOW()
GROUP BY action_tracker_id, DATE(action_date), new_status
ORDER BY action_tracker_id, day, new_status;


-- H&R 5683 — last 100 actions per tracker (combined via UNION ALL; columns that exist)
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12723
  ORDER BY action_date DESC LIMIT 100
) u1
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12724
  ORDER BY action_date DESC LIMIT 100
) u2
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12725
  ORDER BY action_date DESC LIMIT 100
) u3
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 12726
  ORDER BY action_date DESC LIMIT 100
) u4
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 16308
  ORDER BY action_date DESC LIMIT 100
) u5
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 21326
  ORDER BY action_date DESC LIMIT 100
) u6
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 21327
  ORDER BY action_date DESC LIMIT 100
) u7
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 23262
  ORDER BY action_date DESC LIMIT 100
) u8
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 24236
  ORDER BY action_date DESC LIMIT 100
) u9
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 43677
  ORDER BY action_date DESC LIMIT 100
) u10
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 5683 AND action_tracker_id = 51884
  ORDER BY action_date DESC LIMIT 100
) u11
ORDER BY action_tracker_id, action_date DESC;



-- BA 21045 — actions by day (last 30d)
SELECT action_tracker_id,
       DATE(action_date) AS day,
       COUNT(*) AS actions
FROM irac_action2
WHERE campaign_id = 21045
  AND action_tracker_id IN (40062,41815,41816,41817,42474)
  AND action_date >= DATE_SUB(NOW(), INTERVAL 30 DAY) AND action_date < NOW()
GROUP BY action_tracker_id, DATE(action_date)
ORDER BY action_tracker_id, day;



-- BA 21045 — last 100 actions per tracker (combined)
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 40062
  ORDER BY action_date DESC LIMIT 100
) b1
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 41815
  ORDER BY action_date DESC LIMIT 100
) b2
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 41816
  ORDER BY action_date DESC LIMIT 100
) b3
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 41817
  ORDER BY action_date DESC LIMIT 100
) b4
UNION ALL
SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id FROM (
  SELECT action_tracker_id, action_id, action_date, new_status, oid, publisher_id
  FROM irac_action2
  WHERE campaign_id = 21045 AND action_tracker_id = 42474
  ORDER BY action_date DESC LIMIT 100
) b5
ORDER BY action_tracker_id, action_date DESC;
