-- r_ds_ods (SingleStore/MySQL dialect)
-- Purpose: find API/UI calls that created prospects/proposals for adv 5475947 (last 45 days)
SELECT
  doe,
  iram_account_id,
  http_method,
  endpoint,
  -- payload is JSON text; extract common fields if present in your environment:
  JSON_UNQUOTE(JSON_EXTRACT(payload, '$.programId'))     AS program_id_json,
  JSON_UNQUOTE(JSON_EXTRACT(payload, '$.publisherId'))   AS publisher_id_json,
  JSON_UNQUOTE(JSON_EXTRACT(payload, '$.proposalId'))    AS proposal_id_json,
  batch_id
FROM ir_api_log
WHERE iram_account_id = 5475947
  AND doe >= DATE_SUB(NOW(), INTERVAL 45 DAY)
  AND http_method IN ('POST','PUT')
  AND (
       LOWER(endpoint) LIKE '%/prospects%' OR
       LOWER(endpoint) LIKE '%/proposals%' OR
       LOWER(endpoint) LIKE '%/applications%'
  )
ORDER BY doe DESC
LIMIT 1000;


-- r_ds_iram (vetted pattern)
SELECT * FROM irwsapi_webservice_user WHERE iram_account_id IN (5475947);
