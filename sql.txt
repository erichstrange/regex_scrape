-- DRAFT (r_ds_ods) – get the API ingestion row for the exact order Mike cited
SELECT id, batch_id, iram_account_id, ircm_campaign_id, ircm_tracker_id,
       mediapartner_id, submit_date, type, oid, payload
FROM ir_api_log
WHERE iram_account_id = 5804675
  AND ircm_campaign_id = 33961
  AND type = 'Conversion'
  AND oid = 'US-12029583-S'     -- Mike’s example OID from 2025‑10‑02
ORDER BY submit_date DESC
LIMIT 5;



-- VETTED PATTERN (singlestore) – adapted to search by ClickId
SELECT
  cf.event_datetime,
  cf.advertiser_id,
  cf.campaign_id,
  cf.publisher_id,      -- the *partner (MPID)* you need
  cf.profile_id,        -- the *media profile* (often what looks like a “publisher-ish” id)
  cf.click_id,
  cf.landing_page_url,
  cf.classification,
  cf.method
FROM click_fact cf
LEFT JOIN ad_dim ad ON ad.id = cf.ad_dim_id
WHERE cf.click_id = 'Q-OwMOR63xycT:Rx-30mPU2MUkp3jsQmIy7Sww0'   -- ClickId from Mike’s payload
ORDER BY cf.event_datetime DESC
LIMIT 100;



-- Signed contract?
SELECT sc.iram_publisher_id, sc.ircm_campaign_id, sc.date_contract_start, sc.date_contract_end
FROM ircm_signedcontract sc
WHERE sc.ircm_campaign_id = 33961
  AND sc.iram_publisher_id = <publisher_id_from_click_fact>
  AND sc.date_contract_end IS NULL;
